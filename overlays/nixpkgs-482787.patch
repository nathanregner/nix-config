From a892e1b5b4274f181ac713b0975802bc3cca80a2 Mon Sep 17 00:00:00 2001
From: Eldritch Cookie <eldritch.cookie@disroot.org>
Date: Thu, 22 Jan 2026 16:27:33 -0300
Subject: [PATCH] =?UTF-8?q?tree-sitter:=200.25.10=20=E2=86=92=200.26.3?=
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

---
 .../tools/parsing/tree-sitter/default.nix     |  9 ++--
 .../tree-sitter/remove-web-interface.patch    | 54 ++++++++++---------
 2 files changed, 35 insertions(+), 28 deletions(-)

diff --git a/pkgs/development/tools/parsing/tree-sitter/default.nix b/pkgs/development/tools/parsing/tree-sitter/default.nix
index 61516c342af2e..5876c27750629 100644
--- a/pkgs/development/tools/parsing/tree-sitter/default.nix
+++ b/pkgs/development/tools/parsing/tree-sitter/default.nix
@@ -8,6 +8,7 @@
   runCommand,
   which,
   rustPlatform,
+  libclang,
   emscripten,
   openssl,
   pkg-config,
@@ -103,25 +104,27 @@ let
 in
 rustPlatform.buildRustPackage (final: {
   pname = "tree-sitter";
-  version = "0.25.10";
+  version = "0.26.3";
 
   src = fetchFromGitHub {
     owner = "tree-sitter";
     repo = "tree-sitter";
     tag = "v${final.version}";
-    hash = "sha256-aHszbvLCLqCwAS4F4UmM3wbSb81QuG9FM7BDHTu1ZvM=";
+    hash = "sha256-G1C5IhRIVcWUwEI45ELxCKfbZnsJoqan7foSzPP3mMg=";
     fetchSubmodules = true;
   };
 
-  cargoHash = "sha256-4R5Y9yancbg/w3PhACtsWq0+gieUd2j8YnmEj/5eqkg=";
+  cargoHash = "sha256-kHYLaiCHyKG+DL+T2s8yumNHFfndrB5aWs7ept0X4CM=";
 
   buildInputs = [
     installShellFiles
+    libclang
   ]
   ++ lib.optionals webUISupport [
     openssl
   ];
   nativeBuildInputs = [
+    rustPlatform.bindgenHook
     which
   ]
   ++ lib.optionals webUISupport [
diff --git a/pkgs/development/tools/parsing/tree-sitter/remove-web-interface.patch b/pkgs/development/tools/parsing/tree-sitter/remove-web-interface.patch
index 9f3504f33b533..7d8c8f3734f94 100644
--- a/pkgs/development/tools/parsing/tree-sitter/remove-web-interface.patch
+++ b/pkgs/development/tools/parsing/tree-sitter/remove-web-interface.patch
@@ -1,39 +1,43 @@
-diff --git a/cli/src/lib.rs b/cli/src/lib.rs
-index 4a00747e..e17d253b 100644
---- a/cli/src/lib.rs
-+++ b/cli/src/lib.rs
-@@ -6,7 +6,6 @@ pub mod highlight;
- pub mod init;
- pub mod input;
- pub mod logger;
- pub mod parse;
--pub mod playground;
- pub mod query;
- pub mod query_testing;
- pub mod tags;
-diff --git a/cli/src/main.rs b/cli/src/main.rs
-index 1758fada..4bc56cc2 100644
---- a/cli/src/main.rs
-+++ b/cli/src/main.rs
-@@ -23,7 +23,7 @@ use tree_sitter_cli::{
+diff --git a/crates/cli/src/main.rs b/crates/cli/src/main.rs
+index 937e54b4..4d16b739 100644
+--- a/crates/cli/src/main.rs
++++ b/crates/cli/src/main.rs
+@@ -24,7 +24,6 @@ use tree_sitter_cli::{
      input::{get_input, get_tmp_source_file, CliInput},
      logger,
      parse::{self, ParseDebugType, ParseFileOptions, ParseOutput, ParseTheme},
--    playground, query,
-+    query,
+-    playground,
+     query::{self, QueryFileOptions},
      tags::{self, TagsOptions},
-     test::{self, TestOptions, TestStats},
-     test_highlight, test_tags, util, version, wasm,
-@@ -1614,10 +1614,8 @@ impl Tags {
+     test::{self, TestOptions, TestStats, TestSummary},
+@@ -1904,16 +1903,8 @@ impl Tags {
  
  impl Playground {
      fn run(self, current_dir: &Path) -> Result<()> {
--        let open_in_browser = !self.quiet;
 -        let grammar_path = self.grammar_path.as_deref().map_or(current_dir, Path::new);
--        playground::serve(grammar_path, open_in_browser)?;
+-
+-        if let Some(export_path) = self.export {
+-            playground::export(grammar_path, &export_path)?;
+-        } else {
+-            let open_in_browser = !self.quiet;
+-            playground::serve(grammar_path, open_in_browser)?;
+-        }
+-
 -        Ok(())
 +        println!("ERROR: web-ui is not available in this nixpkgs build; enable the webUISupport");
 +        std::process::exit(1);
      }
  }
  
+diff --git a/crates/cli/src/tree_sitter_cli.rs b/crates/cli/src/tree_sitter_cli.rs
+index 3960d961..55f8e2e4 100644
+--- a/crates/cli/src/tree_sitter_cli.rs
++++ b/crates/cli/src/tree_sitter_cli.rs
+@@ -6,7 +6,6 @@ pub mod init;
+ pub mod input;
+ pub mod logger;
+ pub mod parse;
+-pub mod playground;
+ pub mod query;
+ pub mod query_testing;
+ pub mod tags;
